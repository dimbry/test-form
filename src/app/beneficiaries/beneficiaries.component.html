<h4 class="page-title">
  Beneficiaries
</h4>

<div class="form-wrapper">
  <h4>
    Primary Beneficiaries
  </h4>
  <form [formGroup]="beneficiaryForm" class="mt-3" (ngSubmit)="submitBeneficiaries()">
    <div 
      formArrayName="beneficiaries"
      *ngFor="let beneficiary of beneficiariesFormArray.controls; let i = index;">
        <div class="row" [formGroupName]="i">
          <div class="col-2">
            <div class="form-group">
              <label>
                Full name
              </label>
              <input 
                type="text" 
                class="form-control" 
                formControlName="fullName"
                placeholder="John Doe">
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label>
                Date of birth
              </label>
              <input 
                type="text" 
                class="form-control" 
                mask="M0/d0/0000"
                [validation]="true"
                formControlName="birthday"
                placeholder="MM/DD/YYYY">
            </div>
          </div>
          <div class="col-1">
            <div class="form-group no-label">
              <ng-select 
                [items]="typesList"
                bindLabel="name"
                [(ngModel)]="selectedType[i]"
                [clearable]="false" 
                [multiple]="false"
                [searchable]="false"
                formControlName="type">
              </ng-select>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group no-label">
              <input
               type="text"
               class="form-control"
               formControlName="optional"
               placeholder="Optional">
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label>Relationship</label>
              <ng-select 
                [items]="relationshipList"
                bindLabel="name"
                [clearable]="false" 
                placeholder="Select"
                [multiple]="false"
                [searchable]="false"
                [(ngModel)]="selectedRelationship[i]"
                formControlName="relationship">
                 <ng-template ng-option-tmp let-item="item" let-index="index">
                      <span class="ng-value-label">{{ item.name }}</span>
                 </ng-template>
              </ng-select>
            </div>
          </div>
          <div class="col-1">
            <div class="form-group no-label">
              <input
                formControlName="percentage"
                placeholder="0"
                type="number"
                class="form-control">
            </div>
          </div>
          <div class="col-1">
            <button 
              type="button" 
              class="btn btn-primary"
              (click)="removeBeneficiary(i)">X</button>
            <div class="form-check">
              <input 
                class="form-check-input" 
                type="checkbox" 
                value="true"
                *ngIf="beneficiariesFormArray.controls[i].valid && beneficiariesFormArray.controls[i].value.beneficiarySubmitted !== true"
                (change)="addBeneficiary()"
                formControlName="beneficiarySubmitted">
            </div>
          </div>
        </div>
    </div>
  </form>
  <div class="primary-total">
    <span>
      Primary total:
    </span>
    <span>
      {{ percentageSummary + tempPercentageValue +'%' }}
    </span>
  </div>
</div>

<button 
  type="button" 
  class="btn btn-primary"
  (click)="submitBeneficiaries()"
  [disabled]="!beneficiaryForm.disabled || percentageSummary !== 100">
  Next
</button>
